<script>
  import { isDocumentEvent, ready } from '@payloadcms/live-preview';

  const serverURL = import.meta.env.PUBLIC_BACKEND_BASE_URL

  const onMessage = (event) => {
    // Log all incoming messages for debugging
    console.log('Received message:', event.data);
    console.log('Message origin:', event.origin);

    const isFromPayload = isDocumentEvent(event, serverURL);

    console.log('Is event from Payload?', isFromPayload);

    // Check if the event is a document event from the Payload admin
    if (isFromPayload) {
      console.log('Event is valid, reloading page...');
      // If it is, refresh the page to get the latest draft content
      window.location.reload();
    }
  };

  // Add the event listener when the component mounts
  window.addEventListener('message', onMessage);
</script>