---
import type { Page } from 'app-payload';
import { getPayload } from 'payload'
import { config as payloadConfig } from 'app-payload'
import PageRenderer from '../../components/PageRenderer.astro';

export const prerender = false

const { slug } = Astro.params;

// The home page slug is `undefined`, so we map it to 'home' for the API

  const payload = await getPayload({ config: payloadConfig })
  const result = await payload.find({
    collection: 'pages',
    where: {
      slug: {
        equals: slug || 'home',
      },
    },
    depth: 2,
    draft: true,
  });

  const page: Page = result.docs[0]

// Handle 404
if (!page) {
  return Astro.redirect('/404');
}
---

<PageRenderer {page} />
