---
import { getCollection } from 'astro:content'

import Layout from '../layouts/Layout.astro'
import { generateMeta } from 'src/utilities/generateMeta'

import RenderHero from '../components/RenderHero.astro'
import RenderBlocks from '../components/RenderBlocks.astro'

export async function getStaticPaths() {
    const allPages = await getCollection('pages')
    //console.log(JSON.stringify(allPages)) GOOD HERE
    
    const params = allPages.map(({ data: page }) => {
        //console.log(JSON.stringify(page)) // GOOD HERE
        const { slug } = page
        //console.log(JSON.stringify(slug)) GOOD HERE
        if (slug === 'home')
            return {
                params: {slug: undefined },
                props: { page }
            }
        return { 
            params: { slug },
            props: { page }
        }
    })

    return params
}

const { page } = Astro.props
//console.log(JSON.stringify(page)) BAD

const { hero, layout } = page
const {description, openGraph, title} = await generateMeta({doc: page})

 ---

<Layout useTransitions={false} description={description} openGraph={openGraph} title={title}>
	<RenderHero {...hero} />
    <RenderBlocks blocks={layout} />
</Layout>